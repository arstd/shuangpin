<!doctype html>
<html>
    <head>
        <title>双拼布局设计工具</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta name="keywords" content="Dvorak,QWERTY,键盘,布局,打字,双拼" />
        <meta name="author" content="毛毛雨(shangxuejin@gmail.com)" />
        <link rel="stylesheet" href="designassist/designassist.css" />
        <script type="text/javascript" src="scripts/jquery.min.js"></script>
        <link rel="shortcut icon" href="favicon.ico" mce_href="favicon.ico" type="image/x-icon" />
    </head>
    <body>
        <div id="keyboard">
            <script type="text/javascript">
                var keyboard;
                (function(){
                    var keyString = '~$\t%&\t7[\t5{\t3}\t1(\t9=\t0*\t2)\t4+\t6]\t8!\t`#\tBackspace\n' +
                    'Tab\t:;\t<,\t>.\tP\tY\tF\tG\tC\tR\tL\t?/\t^@\t|\\\n' +
                    'Caps Lock\tA\tO\tE\tU\tI\tD\tH\tT\tN\tS\t_-\tEnter\n' +
                    'Shift L\t"\'\tQ\tJ\tK\tX\tB\tM\tW\tV\tZ\tShift R\n' +
                    'Ctrl L\tWin L\tAlt L\tBlank\tAlt R\tWin R\tMenu\tCtrl R'.split('\n');
                    
                    var ctrlkeys = 'Backspace|Tab|Caps Lock|Enter|Shift L|Shift R|Ctrl L|Win L|Alt L|Blank|Alt R|Win R|Menu|Ctrl R';
                    
                    keyboard = getKeyborad(keyString, ctrlkeys);
                    
                    var rowkeyspans = '';
                    $.each(keyboard, function(ri, row){
                        rowkeyspans += '<div id="row' + ri + '">';
                        $.each(row, function(ki, key){
                            if (key instanceof Array) {
                                rowkeyspans += '<div id="key' + (ri * 100 + ki) + '">' +
                                '<span>' +
                                key[0] +
                                '</span><span></span><span></span><span></span>' +
                                '<span>' +
                                (key[1] || '') +
                                '</span><span></span>' +
                                '</div>';
                            }
                            else {
                                rowkeyspans += '<div id="key' + key.replace(/ /g, '') + '">' + (key === 'Blank' ? '' : key) + '</div>';
                            }
                        });
                        rowkeyspans += "</div>";
                    });
                    document.write(rowkeyspans);
                })();
                function getKeyborad(keyString, ctrlKeys){
                    var keyboard = new Array();
                    $.each(keyString.split('\n'), function(ind, val){
                        var row = new Array();
                        $.each(val.split('\t'), function(ind, val){
                            if ($.inArray(val, ctrlKeys.split('|')) >= 0) {
                                row.push(val);
                                return;
                            }
                            var key = new Array();
                            $.each(val.split(''), function(ind, val){
                                key.push(val);
                            });
                            row[ind] = key;
                        });
                        keyboard.push(row);
                    });
                    return keyboard;
                }
            </script>
        </div>
        <div id="final_count">
            <table>
                <tbody>
                    <script type="text/javascript">
                        (function(){
                        
                            var trthtds = '';
                            for (var i = 0; i < 6; i++) {
                                trthtds += '<tr>';
                                for (var j = 0; j < 7; j++) {
                                    trthtds += '<th></th><td></td>';
                                }
                                trthtds += '</tr>';
                            }
                            document.write(trthtds);
                        })()
                    </script>
                </tbody>
            </table>
        </div>
        <script type="text/javascript">
            var initFinalCnt = {}, finalInitCnt = {};
            $(function(){
                var syllableStr = $('#syllable_count').text().trim();
                var lines = syllableStr.split(/\s*\n\s*/);
                var sum = 0;
                for (var i in lines) {
                    var fields = lines[i].split(/,/);
                    var init = fields[0], final = fields[1], cnt = Number(fields[2]);
                    initFinalCnt[init] || (initFinalCnt[init] = {});
                    initFinalCnt[init][final] = cnt;
                    finalInitCnt[final] || (finalInitCnt[final] = {});
                    finalInitCnt[final][init] = cnt;
                    sum += cnt;
                }
                finalInitCnt['*'] = sum;
                initFinalCnt['*'] = sum;
                
                for (var final in finalInitCnt) {
                    var finalSum = 0;
                    for (var init in finalInitCnt[final]) {
                        finalSum += finalInitCnt[final][init];
                    }
                    finalInitCnt[final]['*'] = finalSum;
                }
                for (var init in initFinalCnt) {
                    var initSum = 0;
                    for (var final in initFinalCnt[init]) {
                        initSum += initFinalCnt[init][final];
                    }
                    initFinalCnt[init]['*'] = initSum;
                }
                
                var sorted = new Array();
                for (var final in finalInitCnt) {
                    if (final === '*') 
                        continue;
                    sorted.push({
                        'final': final,
                        '*': finalInitCnt[final]['*']
                    });
                }
                sorted.sort(function(a, b){
                    return b['*'] - a['*'];
                });
                var ths = $('#final_count table th');
                var tds = $('#final_count table td');
                for (var i = 0; i < sorted.length; i++) {
                    $(ths[i]).attr('draggable', true).addClass('draggable').text(sorted[i].final);
                    $(tds[i]).text(percent(sorted[i]['*'], finalInitCnt['*']));
                }
                $(ths[tds.length - 3]).text('zh').attr('draggable', true).addClass('draggable');
                $(tds[tds.length - 3]).text(percent(initFinalCnt['zh']['*'], finalInitCnt['*']));
                $(ths[tds.length - 2]).text('ch').attr('draggable', true).addClass('draggable');
                $(tds[tds.length - 2]).text(percent(initFinalCnt['ch']['*'], finalInitCnt['*']));
                $(ths[tds.length - 1]).text('sh').attr('draggable', true).addClass('draggable');
                $(tds[tds.length - 1]).text(percent(initFinalCnt['sh']['*'], finalInitCnt['*']));
            });
            function percent(x, y){
                var x = Math.round(x * 10000 / y);
                if (String(x).length == 1) 
                    return '0.0' + x;
                else if (String(x).length == 2) 
                    return '0.' + x;
                return String(x).replace(/\d\d$/, function(m){
                    return '.' + m;
                });
            }
        </script>
        <pre id="syllable_count" class="data">
-,a,201272
-,ai,334635
-,an,684007
-,ang,14800
-,ao,185549
-,e,251932
-,ei,1019
-,en,50806
-,er,1763259
-,eng,4566
-,o,8788
-,ou,138266
b,a,988004
b,ai,496336
b,an,809687
b,ang,154298
b,ao,1328261
b,ei,1097420
b,en,714864
b,eng,15099
b,i,936004
b,ian,787533
b,iao,643866
b,ie,288107
b,in,75013
b,ing,708962
b,o,361985
b,u,4079290
c,a,13552
c,ai,713880
c,an,282172
c,ang,107524
c,ao,133381
c,e,233489
c,en,1294
c,eng,224369
c,i,1012511
c,ong,609053
c,ou,7042
c,u,106131
c,uan,5581
c,ui,53114
c,un,331501
c,uo,146756
ch,a,406091
ch,ai,25731
ch,an,759234
ch,ang,1833141
ch,ao,248646
ch,e,350771
ch,en,259833
ch,eng,1786300
ch,i,495085
ch,ong,211952
ch,ou,134427
ch,u,1967791
ch,uai,3058
ch,uan,405214
ch,uang,254143
ch,ui,39692
ch,un,151254
ch,uo,6660
d,a,2504190
d,ai,884245
d,an,923950
d,ang,891698
d,ao,2420704
d,e,12648125
d,en,1
d,eng,688426
d,i,2464890
d,ia,198
d,ian,1114173
d,iao,82297
d,ie,45467
d,ing,754488
d,iu,13940
d,ong,1165941
d,ou,737451
d,u,786771
d,uan,372847
d,ui,1442442
d,un,176038
d,uo,962799
f,a,2009066
f,an,727548
f,ang,1513223
f,ei,634386
f,en,940985
f,eng,504147
f,iao,1
f,o,60890
f,ou,74467
f,u,1828853
g,a,10893
g,ai,607987
g,an,653401
g,ang,357292
g,ao,905985
g,e,2806040
g,ei,309022
g,en,275683
g,eng,310545
g,ong,2233833
g,ou,365284
g,u,697367
g,ua,68982
g,uai,50489
g,uan,1431379
g,uang,442996
g,ui,475659
g,un,23573
g,uo,3794793
h,a,84928
h,ai,1181983
h,an,341652
h,ang,86076
h,ao,827739
h,e,2954203
h,ei,117338
h,en,407974
h,eng,77632
h,ong,257317
h,ou,1024574
h,u,720217
h,ua,1678430
h,uai,123062
h,uan,400747
h,uang,245187
h,ui,2125717
h,un,121763
h,uo,1057000
j,i,5378305
j,ia,2157554
j,ian,2449940
j,iang,1039535
j,iao,1307519
j,ie,1918573
j,in,2332486
j,ing,2273476
j,iong,6143
j,iu,1661613
j,u,1321100
j,uan,75969
j,ue,432269
j,un,558882
k,a,112440
k,ai,781762
k,an,603717
k,ang,152749
k,ao,207528
k,e,1789752
k,en,64266
k,eng,11817
k,ong,319634
k,ou,339630
k,u,213734
k,ua,41951
k,uai,262503
k,uan,129608
k,uang,247950
k,ui,63905
k,un,117150
k,uo,155233
l,a,375599
l,ai,1529184
l,an,265532
l,ang,105177
l,ao,498709
l,e,3261442
l,ei,318430
l,eng,70329
l,i,3806174
l,ian,654728
l,iang,1124509
l,iao,226145
l,ie,281042
l,in,338716
l,ing,694713
l,iu,588318
l,o,420032
l,ong,146958
l,ou,95210
l,u,636664
l,uan,70106
l,un,406465
l,ü,470898
l,üe,80659
m,a,528172
m,ai,240412
m,an,267752
m,ang,84583
m,ao,334500
m,e,528078
m,ei,1387894
m,en,1720313
m,eng,216924
m,i,343947
m,ian,765746
m,iao,98530
m,ie,35532
m,in,858033
m,ing,1132617
m,iu,7021
m,o,414959
m,ou,129246
m,u,762579
n,a,962435
n,ai,85150
n,an,611198
n,ang,7585
n,ao,110603
n,e,131130
n,ei,417476
n,en,8887
n,eng,792017
n,i,874291
n,ian,1655594
n,iang,53417
n,iao,30797
n,ie,22571
n,in,60705
n,ing,93546
n,iu,92280
n,ong,392458
n,ou,47
n,u,102712
n,uan,17816
n,uo,59988
n,ü,294815
n,üe,7138
p,a,118314
p,ai,329952
p,an,167764
p,ang,63052
p,ao,106173
p,ei,225405
p,en,20341
p,eng,162951
p,i,303688
p,ian,246163
p,iao,106892
p,ie,4855
p,in,505207
p,ing,587309
p,o,235226
p,ou,4777
p,u,226948
q,i,2762926
q,ia,30421
q,ian,1086669
q,iang,442737
q,iao,184096
q,ie,329055
q,in,315818
q,ing,1150062
q,iong,35299
q,iu,451786
q,u,1506961
q,uan,1049687
q,ue,421625
q,un,141461
r,an,615505
r,ang,191231
r,ao,43740
r,e,142937
r,en,3508887
r,eng,102022
r,i,991994
r,ong,286618
r,ou,64917
r,u,904745
r,uan,33876
r,ui,63944
r,un,27362
r,uo,98736
s,a,87069
s,ai,235435
s,an,534299
s,ang,44570
s,ao,36542
s,e,237733
s,en,47239
s,eng,6219
s,i,1627242
s,ong,209449
s,ou,29094
s,u,490805
s,uan,141726
s,ui,345439
s,un,115512
s,uo,715502
sh,a,224159
sh,ai,6668
sh,an,470302
sh,ang,2063177
sh,ao,408115
sh,e,1108690
sh,en,1320820
sh,eng,1915764
sh,i,10519921
sh,ou,1317037
sh,u,1499150
sh,ua,18008
sh,uai,37172
sh,uan,5288
sh,uang,143764
sh,ui,593231
sh,un,68835
sh,uo,1201137
t,a,3027330
t,ai,610724
t,an,444706
t,ang,173440
t,ao,248134
t,e,428398
t,eng,37959
t,i,1351257
t,ian,732059
t,iao,608535
t,ie,124700
t,ing,410301
t,ong,1561129
t,ou,630035
t,u,498580
t,uan,212620
t,ui,245341
t,un,18350
t,uo,193842
w,a,90744
w,ai,557152
w,an,861346
w,ang,792760
w,ei,3350224
w,en,1376343
w,eng,11565
w,o,2028466
w,u,1937403
x,i,1847431
x,ia,931711
x,ian,1932126
x,iang,2318846
x,iao,1417531
x,ie,1019414
x,in,1697685
x,ing,2165222
x,iong,124129
x,iu,221318
x,u,845164
x,uan,350471
x,ue,998419
x,un,350632
y,a,493298
y,an,1278355
y,ang,1011614
y,ao,1499898
y,e,2223200
y,i,8560380
y,in,1047274
y,ing,1101740
y,o,3946
y,ong,935706
y,ou,4032007
y,u,2636015
y,uan,1958432
y,ue,989176
y,un,406850
z,a,103539
z,ai,3284695
z,an,99476
z,ang,29007
z,ao,428251
z,e,428144
z,ei,6355
z,en,125548
z,eng,289721
z,i,2380010
z,ong,586703
z,ou,302111
z,u,672366
z,uan,19284
z,ui,553750
z,un,53808
z,uo,1619391
zh,a,71871
zh,ai,91488
zh,an,1149626
zh,ang,524889
zh,ao,420912
zh,e,3562020
zh,en,638433
zh,eng,1726585
zh,i,4617458
zh,ong,3778873
zh,ou,459239
zh,u,1696964
zh,ua,95534
zh,uai,1470
zh,uan,404254
zh,uang,338205
zh,ui,73927
zh,un,172918
zh,uo,64097
        </pre>
        <script type="text/javascript">
            $(function(){
                $('#final_count table th, #keyboard .keymain span:gt(0)').bind({
                    'dragstart': function(ev){
                        ev.stopPropagation();
                        var dt = ev.originalEvent.dataTransfer;
                        dt.setData('Text', $(this).text());
                        if (this.tagName === 'TH') {
                            dt.effectAllowed = 'copy';
                            $(this).addClass('dragging').next('td').addClass('dragging');
                        }
                        else {
                            dt.effectAllowed = 'move';
                            $(this).addClass('dragging');
                        }
                        //dt.setDragImage($('<img src="/favicon.ico" />')[0], 10, 10);
                        return true;
                    },
                    'dragend': function(ev){
                        var dt = ev.originalEvent.dataTransfer;
                        if (dt.dropEffect != 'copy' && dt.dropEffect != 'move') {
                            $(this).removeClass('dragging').next('td').removeClass('dragging');
                            return false;
                        }
                        ev.preventDefault();
                        ev.stopPropagation();
                        if (dt.dropEffect == 'copy') {
                            $(this).attr('draggable', false).removeClass('draggable') //             
                            /*_*/
                            .addClass('dragged').next('td').addClass('dragged');
                        }
                        else if (dt.dropEffect == 'move') {
                            $(this).text('').removeClass('dragging');
                        }
                        return false;
                    }
                });
                $('#keyboard .keymain').bind({
                    'dragenter': function(ev){
                        ev.stopPropagation();
                        ev.preventDefault();
                        var dt = ev.originalEvent.dataTransfer;
                        dt.dropEffect = "copy";
                        $(this).addClass('dragover');
                        return false;
                    },
                    'dragover': function(ev){
                        ev.stopPropagation();
                        ev.preventDefault();
                        $(this).addClass('dragover');
                        return false;
                    },
                    'dragleave': function(ev){
                        ev.preventDefault();
                        $(this).removeClass('dragover');
                        return false;
                    },
                    'drop': function(ev){
                        ev.preventDefault();
                        $(this).removeClass('dragover');
                        var dt = ev.originalEvent.dataTransfer;
                        var text = dt.getData('Text');
                        if ('zh,ch,sh'.indexOf(text) >= 0) {
                            $(this).find('span:eq(1)').text(text)//
                            /*_*/
                            .attr('draggable', true).addClass('draggable');
                        }
                        else {
                            if (!$(this).find('span:eq(5)').text()) {
                                $(this).find('span:eq(5)').text(text)//
                                /*_*/
                                .attr('draggable', true).addClass('draggable');
                            }
                            else if (!$(this).find('span:eq(4)').text()) {
                                $(this).find('span:eq(4)').text(text)//
                                /*_*/
                                .attr('draggable', true).addClass('draggable');
                            }
                            else {
                                $(this).find('span:eq(2)').text(text)//
                                /*_*/
                                .attr('draggable', true).addClass('draggable');
                            }
                        }
                        return false;
                    }
                });
            })
        </script>
    </body>
</html>
